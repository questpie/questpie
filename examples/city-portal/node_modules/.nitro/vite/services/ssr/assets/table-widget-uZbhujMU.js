import { jsx, jsxs } from "react/jsx-runtime";
import { f as useResolveText, h as useCollectionList, W as WidgetCard, j as DefaultCell } from "./admin-NRknLhg2.js";
import { c as cn, a as formatLabel } from "./utils-P1tbtlFB.js";
import { T as TableWidgetSkeleton } from "./widget-skeletons-i0KIuI2-.js";
import "react";
import "@base-ui/react/merge-props";
import "@base-ui/react/use-render";
import "@iconify/react";
import "class-variance-authority";
import "@base-ui/react/separator";
import "sonner";
import "@tanstack/react-query";
import "./router-DfekICpe.js";
import "@tanstack/react-router";
import "node:crypto";
import "node:async_hooks";
import "drizzle-orm";
import "drizzle-orm/pg-core";
import "zod";
import "node:os";
import "node:path";
import "../index.js";
import "@tanstack/react-router/ssr/server";
import "bun";
import "drizzle-orm/bun-sql";
import "drizzle-orm/pglite";
import "buffer";
import "path/posix";
import "path";
import "node:util";
import "crypto";
import "fs";
import "fs/promises";
import "url";
import "util";
import "assert";
import "drizzle-orm/casing";
import "node:fs";
import "node:events";
import "node:diagnostics_channel";
import "events";
import "worker_threads";
import "module";
import "prettier/plugins/html";
import "prettier/standalone";
import "node:stream";
import "http";
import "https";
import "zlib";
import "stream";
import "net";
import "dns";
import "os";
import "tls";
import "child_process";
import "node:assert";
import "node:timers/promises";
import "string_decoder";
import "@base-ui/react/button";
import "@base-ui/react/dialog";
import "@base-ui/react/accordion";
import "@base-ui/react/tabs";
import "@base-ui/react/checkbox";
import "@base-ui/react/switch";
import "@base-ui/react/menu";
import "date-fns";
import "@base-ui/react/popover";
import "date-fns/locale";
import "@base-ui/react/input";
import "react-dom";
import "@base-ui/react/select";
import "@base-ui/react/tooltip";
import "clsx";
import "tailwind-merge";
const FIELD_TYPES_NEEDING_FIELD_DEF = /* @__PURE__ */ new Set([
  "object",
  "array",
  "relation",
  "reverseRelation"
]);
function normalizeColumn(column) {
  if (typeof column === "string") {
    return { key: column };
  }
  return column;
}
function getColumnLabel(column, fieldDef) {
  if (column.label) {
    return column.label;
  }
  return formatLabel(column.key);
}
function resolveCellComponent(fieldDef) {
  return DefaultCell;
}
function TableWidget({
  config,
  basePath = "/admin",
  navigate
}) {
  const resolveText = useResolveText();
  const {
    collection,
    columns: rawColumns,
    limit = 5,
    sortBy,
    sortOrder = "desc",
    filter,
    linkToDetail,
    emptyMessage,
    realtime
  } = config;
  const columns = rawColumns.map(normalizeColumn);
  const fields = void 0;
  const queryOptions = { limit };
  if (sortBy) {
    queryOptions.orderBy = { [sortBy]: sortOrder };
  }
  if (filter) {
    queryOptions.where = filter;
  }
  const { data, isLoading, error, refetch } = useCollectionList(
    collection,
    queryOptions,
    void 0,
    { realtime }
  );
  const items = Array.isArray(data?.docs) ? data.docs : [];
  const title = config.title ? resolveText(config.title) : void 0;
  const handleRowClick = (item) => {
    if (linkToDetail && navigate) {
      navigate(`${basePath}/collections/${collection}/${item.id}`);
    }
  };
  const renderCell = (item, column) => {
    const value = item[column.key];
    if (column.render) {
      return column.render(value, item);
    }
    const fieldDef = fields?.[column.key];
    const CellComponent = resolveCellComponent();
    const fieldType = "text";
    const needsFieldDef = FIELD_TYPES_NEEDING_FIELD_DEF.has(fieldType);
    return needsFieldDef ? /* @__PURE__ */ jsx(CellComponent, { value, row: item, fieldDef }) : /* @__PURE__ */ jsx(CellComponent, { value, row: item });
  };
  const emptyContent = /* @__PURE__ */ jsx("div", { className: "flex h-24 items-center justify-center text-muted-foreground", children: /* @__PURE__ */ jsx("p", { className: "text-sm", children: emptyMessage ? resolveText(emptyMessage) : "No data available" }) });
  const tableContent = items.length === 0 ? emptyContent : /* @__PURE__ */ jsxs("div", { className: "-mx-5 -mb-1", children: [
    /* @__PURE__ */ jsx("div", { className: "flex items-center gap-2 px-5 py-2 border-b border-border/30 text-[10px] font-medium uppercase tracking-wider text-muted-foreground bg-muted/20 backdrop-blur-sm", children: columns.map((column) => {
      const label = getColumnLabel(column);
      return /* @__PURE__ */ jsx(
        "div",
        {
          className: cn(
            "flex-1 min-w-0",
            column.align === "center" && "text-center",
            column.align === "right" && "text-right"
          ),
          style: column.width ? { width: column.width, flex: "none" } : void 0,
          children: resolveText(label)
        },
        column.key
      );
    }) }),
    items.map(
      (item) => linkToDetail ? /* @__PURE__ */ jsx(
        "button",
        {
          type: "button",
          className: "flex w-full items-center gap-2 px-5 py-2.5 border-b border-border/20 last:border-0 transition-all cursor-pointer hover:bg-muted/30 hover:backdrop-blur-sm text-left",
          onClick: () => handleRowClick(item),
          children: columns.map((column) => /* @__PURE__ */ jsx(
            "div",
            {
              className: cn(
                "flex-1 min-w-0 text-sm truncate",
                column.align === "center" && "text-center",
                column.align === "right" && "text-right"
              ),
              style: column.width ? { width: column.width, flex: "none" } : void 0,
              children: renderCell(item, column)
            },
            column.key
          ))
        },
        item.id
      ) : /* @__PURE__ */ jsx(
        "div",
        {
          className: "flex items-center gap-2 px-5 py-2.5 border-b border-border/20 last:border-0",
          children: columns.map((column) => /* @__PURE__ */ jsx(
            "div",
            {
              className: cn(
                "flex-1 min-w-0 text-sm truncate",
                column.align === "center" && "text-center",
                column.align === "right" && "text-right"
              ),
              style: column.width ? { width: column.width, flex: "none" } : void 0,
              children: renderCell(item, column)
            },
            column.key
          ))
        },
        item.id
      )
    )
  ] });
  return /* @__PURE__ */ jsx(
    WidgetCard,
    {
      title,
      isLoading,
      loadingSkeleton: /* @__PURE__ */ jsx(TableWidgetSkeleton, { rows: limit, columns: columns.length }),
      error: error instanceof Error ? error : error ? new Error(String(error)) : null,
      onRefresh: () => refetch(),
      children: tableContent
    }
  );
}
export {
  TableWidget as default
};

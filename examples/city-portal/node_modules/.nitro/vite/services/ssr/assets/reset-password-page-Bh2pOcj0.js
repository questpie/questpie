import { jsxs, jsx, Fragment } from "react/jsx-runtime";
import * as React from "react";
import { v as useTranslation, l as useForm, B as Button, F as FieldGroup, m as Field, n as FieldLabel, o as FieldContent, I as Input, w as FieldDescription, p as FieldError, q as useAuthClient, u as useAdminStore, e as selectNavigate, s as selectBasePath, t as selectBrandName } from "./admin-NRknLhg2.js";
import { A as Alert, a as AlertDescription, b as AuthLayout } from "./alert-DSUNWvis.js";
import { Icon } from "@iconify/react";
import { c as cn } from "./utils-P1tbtlFB.js";
import "@base-ui/react/merge-props";
import "@base-ui/react/use-render";
import "class-variance-authority";
import "@base-ui/react/separator";
import "sonner";
import "@tanstack/react-query";
import "./router-DfekICpe.js";
import "@tanstack/react-router";
import "node:crypto";
import "node:async_hooks";
import "drizzle-orm";
import "drizzle-orm/pg-core";
import "zod";
import "node:os";
import "node:path";
import "../index.js";
import "@tanstack/react-router/ssr/server";
import "bun";
import "drizzle-orm/bun-sql";
import "drizzle-orm/pglite";
import "buffer";
import "path/posix";
import "path";
import "node:util";
import "crypto";
import "fs";
import "fs/promises";
import "url";
import "util";
import "assert";
import "drizzle-orm/casing";
import "node:fs";
import "node:events";
import "node:diagnostics_channel";
import "events";
import "worker_threads";
import "module";
import "prettier/plugins/html";
import "prettier/standalone";
import "node:stream";
import "http";
import "https";
import "zlib";
import "stream";
import "net";
import "dns";
import "os";
import "tls";
import "child_process";
import "node:assert";
import "node:timers/promises";
import "string_decoder";
import "@base-ui/react/button";
import "@base-ui/react/dialog";
import "@base-ui/react/accordion";
import "@base-ui/react/tabs";
import "@base-ui/react/checkbox";
import "@base-ui/react/switch";
import "@base-ui/react/menu";
import "date-fns";
import "@base-ui/react/popover";
import "date-fns/locale";
import "@base-ui/react/input";
import "react-dom";
import "@base-ui/react/select";
import "@base-ui/react/tooltip";
import "clsx";
import "tailwind-merge";
function ResetPasswordForm({
  token,
  onSubmit,
  onBackToLoginClick,
  minPasswordLength = 8,
  className,
  error
}) {
  const { t } = useTranslation();
  const [isSuccess, setIsSuccess] = React.useState(false);
  const {
    register,
    handleSubmit,
    watch,
    formState: { errors, isSubmitting }
  } = useForm({
    defaultValues: {
      password: "",
      confirmPassword: ""
    }
  });
  const password = watch("password");
  const handleFormSubmit = handleSubmit(async (values) => {
    try {
      await onSubmit({ ...values, token });
      setIsSuccess(true);
    } catch {
    }
  });
  if (isSuccess) {
    return /* @__PURE__ */ jsxs("div", { className: cn("space-y-4 text-center", className), children: [
      /* @__PURE__ */ jsx("div", { className: "bg-primary/10 mx-auto flex size-12 items-center justify-center", children: /* @__PURE__ */ jsx(
        Icon,
        {
          icon: "ph:check-circle-duotone",
          className: "text-primary size-6"
        }
      ) }),
      /* @__PURE__ */ jsxs("div", { className: "space-y-2", children: [
        /* @__PURE__ */ jsx("h3", { className: "text-sm font-medium", children: "Password reset successful" }),
        /* @__PURE__ */ jsx("p", { className: "text-muted-foreground text-xs", children: "Your password has been reset successfully. You can now sign in with your new password." })
      ] }),
      /* @__PURE__ */ jsx(
        Button,
        {
          type: "button",
          className: "w-full",
          size: "lg",
          onClick: onBackToLoginClick,
          children: "Sign in"
        }
      )
    ] });
  }
  return /* @__PURE__ */ jsxs("form", { onSubmit: handleFormSubmit, className: cn("space-y-4", className), children: [
    /* @__PURE__ */ jsx("p", { className: "text-muted-foreground text-xs", children: "Enter your new password below." }),
    /* @__PURE__ */ jsxs(FieldGroup, { children: [
      /* @__PURE__ */ jsxs(Field, { "data-invalid": !!errors.password, children: [
        /* @__PURE__ */ jsx(FieldLabel, { htmlFor: "password", children: t("auth.newPassword") }),
        /* @__PURE__ */ jsxs(FieldContent, { children: [
          /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsx(
              Icon,
              {
                icon: "ph:lock-duotone",
                className: "text-muted-foreground absolute left-2 top-1/2 size-4 -translate-y-1/2"
              }
            ),
            /* @__PURE__ */ jsx(
              Input,
              {
                id: "password",
                type: "password",
                placeholder: t("auth.newPasswordPlaceholder"),
                className: "pl-8",
                autoComplete: "new-password",
                "aria-invalid": !!errors.password,
                ...register("password", {
                  required: t("auth.passwordRequired"),
                  minLength: {
                    value: minPasswordLength,
                    message: t("auth.passwordMinLength", {
                      min: minPasswordLength
                    })
                  }
                })
              }
            )
          ] }),
          /* @__PURE__ */ jsx(FieldDescription, { children: t("auth.passwordMinLength", { min: minPasswordLength }) }),
          /* @__PURE__ */ jsx(FieldError, { children: errors.password?.message })
        ] })
      ] }),
      /* @__PURE__ */ jsxs(Field, { "data-invalid": !!errors.confirmPassword, children: [
        /* @__PURE__ */ jsx(FieldLabel, { htmlFor: "confirmPassword", children: t("auth.confirmPassword") }),
        /* @__PURE__ */ jsxs(FieldContent, { children: [
          /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsx(
              Icon,
              {
                icon: "ph:lock-duotone",
                className: "text-muted-foreground absolute left-2 top-1/2 size-4 -translate-y-1/2"
              }
            ),
            /* @__PURE__ */ jsx(
              Input,
              {
                id: "confirmPassword",
                type: "password",
                placeholder: t("auth.confirmPasswordPlaceholder"),
                className: "pl-8",
                autoComplete: "new-password",
                "aria-invalid": !!errors.confirmPassword,
                ...register("confirmPassword", {
                  required: t("auth.passwordRequired"),
                  validate: (value) => value === password || t("auth.passwordMismatch")
                })
              }
            )
          ] }),
          /* @__PURE__ */ jsx(FieldError, { children: errors.confirmPassword?.message })
        ] })
      ] })
    ] }),
    error && /* @__PURE__ */ jsxs(Alert, { variant: "destructive", children: [
      /* @__PURE__ */ jsx(Icon, { icon: "ph:warning-circle" }),
      /* @__PURE__ */ jsx(AlertDescription, { children: error })
    ] }),
    /* @__PURE__ */ jsx(
      Button,
      {
        type: "submit",
        className: "w-full",
        size: "lg",
        disabled: isSubmitting,
        children: isSubmitting ? /* @__PURE__ */ jsxs(Fragment, { children: [
          /* @__PURE__ */ jsx(Icon, { icon: "ph:spinner-gap-bold", className: "animate-spin" }),
          t("auth.resettingPassword")
        ] }) : t("auth.resetPassword")
      }
    ),
    /* @__PURE__ */ jsxs("p", { className: "text-muted-foreground text-center text-xs", children: [
      t("auth.alreadyHaveAccount"),
      " ",
      /* @__PURE__ */ jsx(
        Button,
        {
          type: "button",
          variant: "link",
          size: "sm",
          onClick: onBackToLoginClick,
          className: "h-auto p-0 text-xs",
          children: t("auth.signIn")
        }
      )
    ] })
  ] });
}
function ResetPasswordPage({
  title = "Reset password",
  description = "Enter your new password",
  logo,
  loginPath,
  minPasswordLength = 8,
  getToken
}) {
  const authClient = useAuthClient();
  const navigate = useAdminStore(selectNavigate);
  const basePath = useAdminStore(selectBasePath);
  const brandName = useAdminStore(selectBrandName);
  const [error, setError] = React.useState(null);
  const token = React.useMemo(() => {
    if (getToken) {
      return getToken();
    }
    if (typeof window !== "undefined") {
      const params = new URLSearchParams(window.location.search);
      return params.get("token");
    }
    return null;
  }, [getToken]);
  const handleSubmit = async (values) => {
    setError(null);
    try {
      const result = await authClient.resetPassword({
        token: values.token,
        newPassword: values.password
      });
      if (result.error) {
        setError(result.error.message || "Failed to reset password");
        return;
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : "An error occurred");
    }
  };
  const handleBackToLoginClick = () => {
    navigate(loginPath ?? `${basePath}/login`);
  };
  if (!token) {
    return /* @__PURE__ */ jsx(
      AuthLayout,
      {
        title: "Invalid Link",
        description: "The password reset link is invalid or has expired.",
        logo: logo ?? /* @__PURE__ */ jsx(DefaultLogo, { brandName }),
        children: /* @__PURE__ */ jsxs("div", { className: "space-y-4 text-center", children: [
          /* @__PURE__ */ jsx("p", { className: "text-muted-foreground text-sm", children: "Please request a new password reset link." }),
          /* @__PURE__ */ jsx(Button, { type: "button", variant: "link", onClick: handleBackToLoginClick, children: "Back to login" })
        ] })
      }
    );
  }
  return /* @__PURE__ */ jsx(
    AuthLayout,
    {
      title,
      description,
      logo: logo ?? /* @__PURE__ */ jsx(DefaultLogo, { brandName }),
      children: /* @__PURE__ */ jsx(
        ResetPasswordForm,
        {
          token,
          onSubmit: handleSubmit,
          onBackToLoginClick: handleBackToLoginClick,
          minPasswordLength,
          error
        }
      )
    }
  );
}
function DefaultLogo({ brandName }) {
  return /* @__PURE__ */ jsx("div", { className: "text-center", children: /* @__PURE__ */ jsx("h1", { className: "text-xl font-bold", children: brandName }) });
}
export {
  ResetPasswordPage,
  ResetPasswordPage as default
};

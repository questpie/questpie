import { jsxs, jsx, Fragment } from "react/jsx-runtime";
import * as React from "react";
import { v as useTranslation, l as useForm, F as FieldGroup, m as Field, n as FieldLabel, o as FieldContent, I as Input, p as FieldError, B as Button, u as useAdminStore, i as selectClient, e as selectNavigate, s as selectBasePath, t as selectBrandName } from "./admin-NRknLhg2.js";
import { A as Alert, a as AlertDescription, b as AuthLayout } from "./alert-DSUNWvis.js";
import { Icon } from "@iconify/react";
import { c as cn } from "./utils-P1tbtlFB.js";
import "@base-ui/react/merge-props";
import "@base-ui/react/use-render";
import "class-variance-authority";
import "@base-ui/react/separator";
import "sonner";
import "@tanstack/react-query";
import "./router-DfekICpe.js";
import "@tanstack/react-router";
import "node:crypto";
import "node:async_hooks";
import "drizzle-orm";
import "drizzle-orm/pg-core";
import "zod";
import "node:os";
import "node:path";
import "../index.js";
import "@tanstack/react-router/ssr/server";
import "bun";
import "drizzle-orm/bun-sql";
import "drizzle-orm/pglite";
import "buffer";
import "path/posix";
import "path";
import "node:util";
import "crypto";
import "fs";
import "fs/promises";
import "url";
import "util";
import "assert";
import "drizzle-orm/casing";
import "node:fs";
import "node:events";
import "node:diagnostics_channel";
import "events";
import "worker_threads";
import "module";
import "prettier/plugins/html";
import "prettier/standalone";
import "node:stream";
import "http";
import "https";
import "zlib";
import "stream";
import "net";
import "dns";
import "os";
import "tls";
import "child_process";
import "node:assert";
import "node:timers/promises";
import "string_decoder";
import "@base-ui/react/button";
import "@base-ui/react/dialog";
import "@base-ui/react/accordion";
import "@base-ui/react/tabs";
import "@base-ui/react/checkbox";
import "@base-ui/react/switch";
import "@base-ui/react/menu";
import "date-fns";
import "@base-ui/react/popover";
import "date-fns/locale";
import "@base-ui/react/input";
import "react-dom";
import "@base-ui/react/select";
import "@base-ui/react/tooltip";
import "clsx";
import "tailwind-merge";
function SetupForm({
  onSubmit,
  defaultValues,
  className,
  error,
  minPasswordLength = 8
}) {
  const { t } = useTranslation();
  const {
    register,
    handleSubmit,
    watch,
    formState: { errors, isSubmitting }
  } = useForm({
    defaultValues: {
      name: "",
      email: "",
      password: "",
      confirmPassword: "",
      ...defaultValues
    }
  });
  const password = watch("password");
  const handleFormSubmit = handleSubmit(async (values) => {
    await onSubmit(values);
  });
  return /* @__PURE__ */ jsxs("form", { onSubmit: handleFormSubmit, className: cn("space-y-4", className), children: [
    /* @__PURE__ */ jsxs(FieldGroup, { children: [
      /* @__PURE__ */ jsxs(Field, { "data-invalid": !!errors.name, children: [
        /* @__PURE__ */ jsx(FieldLabel, { htmlFor: "name", children: t("auth.name") }),
        /* @__PURE__ */ jsxs(FieldContent, { children: [
          /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsx(
              Icon,
              {
                icon: "ph:user-duotone",
                className: "text-muted-foreground absolute left-2 top-1/2 size-4 -translate-y-1/2"
              }
            ),
            /* @__PURE__ */ jsx(
              Input,
              {
                id: "name",
                type: "text",
                placeholder: t("auth.namePlaceholder"),
                className: "pl-8",
                autoComplete: "name",
                "aria-invalid": !!errors.name,
                ...register("name", {
                  required: t("auth.nameRequired"),
                  minLength: {
                    value: 2,
                    message: t("auth.nameMinLength", { min: 2 })
                  }
                })
              }
            )
          ] }),
          /* @__PURE__ */ jsx(FieldError, { children: errors.name?.message })
        ] })
      ] }),
      /* @__PURE__ */ jsxs(Field, { "data-invalid": !!errors.email, children: [
        /* @__PURE__ */ jsx(FieldLabel, { htmlFor: "email", children: t("auth.email") }),
        /* @__PURE__ */ jsxs(FieldContent, { children: [
          /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsx(
              Icon,
              {
                icon: "ph:envelope-duotone",
                className: "text-muted-foreground absolute left-2 top-1/2 size-4 -translate-y-1/2"
              }
            ),
            /* @__PURE__ */ jsx(
              Input,
              {
                id: "email",
                type: "email",
                placeholder: t("auth.emailPlaceholder"),
                className: "pl-8",
                autoComplete: "email",
                "aria-invalid": !!errors.email,
                ...register("email", {
                  required: t("auth.emailRequired"),
                  pattern: {
                    value: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
                    message: t("auth.invalidEmail")
                  }
                })
              }
            )
          ] }),
          /* @__PURE__ */ jsx(FieldError, { children: errors.email?.message })
        ] })
      ] }),
      /* @__PURE__ */ jsxs(Field, { "data-invalid": !!errors.password, children: [
        /* @__PURE__ */ jsx(FieldLabel, { htmlFor: "password", children: t("auth.password") }),
        /* @__PURE__ */ jsxs(FieldContent, { children: [
          /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsx(
              Icon,
              {
                icon: "ph:lock-duotone",
                className: "text-muted-foreground absolute left-2 top-1/2 size-4 -translate-y-1/2"
              }
            ),
            /* @__PURE__ */ jsx(
              Input,
              {
                id: "password",
                type: "password",
                placeholder: t("auth.passwordPlaceholder"),
                className: "pl-8",
                autoComplete: "new-password",
                "aria-invalid": !!errors.password,
                ...register("password", {
                  required: t("auth.passwordRequired"),
                  minLength: {
                    value: minPasswordLength,
                    message: t("auth.passwordMinLength", {
                      min: minPasswordLength
                    })
                  }
                })
              }
            )
          ] }),
          /* @__PURE__ */ jsx(FieldError, { children: errors.password?.message })
        ] })
      ] }),
      /* @__PURE__ */ jsxs(Field, { "data-invalid": !!errors.confirmPassword, children: [
        /* @__PURE__ */ jsx(FieldLabel, { htmlFor: "confirmPassword", children: t("auth.confirmPassword") }),
        /* @__PURE__ */ jsxs(FieldContent, { children: [
          /* @__PURE__ */ jsxs("div", { className: "relative", children: [
            /* @__PURE__ */ jsx(
              Icon,
              {
                icon: "ph:lock-duotone",
                className: "text-muted-foreground absolute left-2 top-1/2 size-4 -translate-y-1/2"
              }
            ),
            /* @__PURE__ */ jsx(
              Input,
              {
                id: "confirmPassword",
                type: "password",
                placeholder: t("auth.confirmPasswordPlaceholder"),
                className: "pl-8",
                autoComplete: "new-password",
                "aria-invalid": !!errors.confirmPassword,
                ...register("confirmPassword", {
                  required: t("auth.passwordRequired"),
                  validate: (value) => value === password || t("auth.passwordMismatch")
                })
              }
            )
          ] }),
          /* @__PURE__ */ jsx(FieldError, { children: errors.confirmPassword?.message })
        ] })
      ] })
    ] }),
    error && /* @__PURE__ */ jsxs(Alert, { variant: "destructive", children: [
      /* @__PURE__ */ jsx(Icon, { icon: "ph:warning-circle" }),
      /* @__PURE__ */ jsx(AlertDescription, { children: error })
    ] }),
    /* @__PURE__ */ jsx(
      Button,
      {
        type: "submit",
        className: "w-full",
        size: "lg",
        disabled: isSubmitting,
        children: isSubmitting ? /* @__PURE__ */ jsxs(Fragment, { children: [
          /* @__PURE__ */ jsx(Icon, { icon: "ph:spinner-gap-bold", className: "animate-spin" }),
          t("auth.creatingAdmin")
        ] }) : t("auth.createFirstAdmin")
      }
    )
  ] });
}
function SetupPage({
  title = "Welcome",
  description = "Create your admin account to get started",
  logo,
  redirectTo,
  loginPath,
  showLoginLink = true
}) {
  const client = useAdminStore(selectClient);
  const navigate = useAdminStore(selectNavigate);
  const basePath = useAdminStore(selectBasePath);
  const brandName = useAdminStore(selectBrandName);
  const [error, setError] = React.useState(null);
  const handleSubmit = async (values) => {
    setError(null);
    try {
      const result = await client.rpc.createFirstAdmin({
        email: values.email,
        password: values.password,
        name: values.name
      });
      if (!result.success) {
        setError(result.error ?? "Failed to create admin account");
        return;
      }
      navigate(redirectTo ?? `${basePath}/login`);
    } catch (err) {
      setError(err instanceof Error ? err.message : "An error occurred");
    }
  };
  const handleLoginClick = () => {
    navigate(loginPath ?? `${basePath}/login`);
  };
  return /* @__PURE__ */ jsx(
    AuthLayout,
    {
      title,
      description,
      logo: logo ?? /* @__PURE__ */ jsx(DefaultLogo, { brandName }),
      footer: showLoginLink && /* @__PURE__ */ jsxs("p", { className: "text-muted-foreground text-center text-xs", children: [
        "Already have an account?",
        " ",
        /* @__PURE__ */ jsx(
          "button",
          {
            type: "button",
            onClick: handleLoginClick,
            className: "text-primary hover:underline",
            children: "Sign in"
          }
        )
      ] }),
      children: /* @__PURE__ */ jsx(SetupForm, { onSubmit: handleSubmit, error })
    }
  );
}
function DefaultLogo({ brandName }) {
  return /* @__PURE__ */ jsx("div", { className: "text-center", children: /* @__PURE__ */ jsx("h1", { className: "text-xl font-bold", children: brandName }) });
}
export {
  SetupPage,
  SetupPage as default
};

import { jsx, jsxs, Fragment } from "react/jsx-runtime";
import { f as useResolveText, h as useCollectionList, W as WidgetCard } from "./admin-NRknLhg2.js";
import { f as formatCollectionName } from "./utils-P1tbtlFB.js";
import { R as RecentItemsWidgetSkeleton } from "./widget-skeletons-i0KIuI2-.js";
import "react";
import "@base-ui/react/merge-props";
import "@base-ui/react/use-render";
import "@iconify/react";
import "class-variance-authority";
import "@base-ui/react/separator";
import "sonner";
import "@tanstack/react-query";
import "./router-DfekICpe.js";
import "@tanstack/react-router";
import "node:crypto";
import "node:async_hooks";
import "drizzle-orm";
import "drizzle-orm/pg-core";
import "zod";
import "node:os";
import "node:path";
import "../index.js";
import "@tanstack/react-router/ssr/server";
import "bun";
import "drizzle-orm/bun-sql";
import "drizzle-orm/pglite";
import "buffer";
import "path/posix";
import "path";
import "node:util";
import "crypto";
import "fs";
import "fs/promises";
import "url";
import "util";
import "assert";
import "drizzle-orm/casing";
import "node:fs";
import "node:events";
import "node:diagnostics_channel";
import "events";
import "worker_threads";
import "module";
import "prettier/plugins/html";
import "prettier/standalone";
import "node:stream";
import "http";
import "https";
import "zlib";
import "stream";
import "net";
import "dns";
import "os";
import "tls";
import "child_process";
import "node:assert";
import "node:timers/promises";
import "string_decoder";
import "@base-ui/react/button";
import "@base-ui/react/dialog";
import "@base-ui/react/accordion";
import "@base-ui/react/tabs";
import "@base-ui/react/checkbox";
import "@base-ui/react/switch";
import "@base-ui/react/menu";
import "date-fns";
import "@base-ui/react/popover";
import "date-fns/locale";
import "@base-ui/react/input";
import "react-dom";
import "@base-ui/react/select";
import "@base-ui/react/tooltip";
import "clsx";
import "tailwind-merge";
function RecentItemsWidget({ config }) {
  const resolveText = useResolveText();
  const {
    collection,
    limit = 5,
    label,
    titleField = "_title",
    dateField = "createdAt",
    subtitleFields,
    onItemClick,
    realtime
  } = config;
  const { data, isLoading, error, refetch } = useCollectionList(
    collection,
    {
      orderBy: { [dateField]: "desc" },
      limit
    },
    void 0,
    { realtime }
  );
  const items = Array.isArray(data?.docs) ? data.docs : [];
  const displayLabel = label ? resolveText(label) : `Recent ${formatCollectionName(collection)}`;
  const getTitleValue = (item) => {
    if (titleField && item[titleField]) return String(item[titleField]);
    if (item._title) return String(item._title);
    if (item.name) return String(item.name);
    if (item.title) return String(item.title);
    if (item.label) return String(item.label);
    return `Item #${item.id}`;
  };
  const getSubtitle = (item) => {
    if (!subtitleFields?.length) return null;
    return subtitleFields.map((field) => item[field]).filter(Boolean).join(" - ");
  };
  const handleItemClick = (item) => {
    if (onItemClick) {
      onItemClick(item);
    }
  };
  const listContent = items.length === 0 ? /* @__PURE__ */ jsx("p", { className: "text-sm text-muted-foreground", children: "No items yet" }) : /* @__PURE__ */ jsx("div", { className: "space-y-1", children: items.map((item) => {
    const dateValue = item[dateField];
    const subtitle = getSubtitle(item);
    return /* @__PURE__ */ jsx(
      "button",
      {
        type: "button",
        onClick: () => handleItemClick(item),
        className: "flex w-full items-center gap-3 rounded-md p-2 hover:bg-muted/50 cursor-pointer transition-colors text-left",
        children: /* @__PURE__ */ jsxs("div", { className: "flex-1 min-w-0", children: [
          /* @__PURE__ */ jsx("p", { className: "text-sm font-medium truncate", children: getTitleValue(item) }),
          /* @__PURE__ */ jsxs("div", { className: "flex items-center gap-2 text-xs text-muted-foreground", children: [
            dateValue && /* @__PURE__ */ jsx("span", { children: formatRelativeTime(new Date(dateValue)) }),
            subtitle && /* @__PURE__ */ jsxs(Fragment, { children: [
              /* @__PURE__ */ jsx("span", { children: "-" }),
              /* @__PURE__ */ jsx("span", { className: "truncate", children: subtitle })
            ] })
          ] })
        ] })
      },
      item.id
    );
  }) });
  return /* @__PURE__ */ jsx(
    WidgetCard,
    {
      title: displayLabel,
      isLoading,
      loadingSkeleton: /* @__PURE__ */ jsx(RecentItemsWidgetSkeleton, { count: limit }),
      error: error instanceof Error ? error : error ? new Error(String(error)) : null,
      onRefresh: () => refetch(),
      children: listContent
    }
  );
}
function formatRelativeTime(date) {
  const now = /* @__PURE__ */ new Date();
  const diff = now.getTime() - date.getTime();
  const seconds = Math.floor(diff / 1e3);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  if (days > 0) return `${days}d ago`;
  if (hours > 0) return `${hours}h ago`;
  if (minutes > 0) return `${minutes}m ago`;
  return "just now";
}
export {
  RecentItemsWidget as default
};

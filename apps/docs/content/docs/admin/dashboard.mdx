---
title: Dashboard Configuration
description: Build dashboards with widgets, charts, and server-side data fetching
---

# Dashboard Configuration

The dashboard is configured on the **server** using the `.dashboard()` method. It supports 9 widget types, server-side data fetching via `fetchFn`, and per-widget access control.

## Basic Configuration

```typescript
// src/questpie/server/cms.ts
const cms = q({ name: "my-cms" })
  .use(adminModule)
  .collections({ posts, users })
  .dashboard(({ d, c }) => d.dashboard({
    title: { en: "Dashboard", sk: "Prehľad" },
    columns: 4,
    items: [
      d.stats({
        collection: "posts",
        label: { en: "Total Posts" },
        icon: c.icon("ph:article"),
        span: 1,
      }),
    ],
  }))
  .build({ db: { url: "..." } });
```

The `({ d, c })` callback provides:
- **`d`** — Dashboard builder helpers (`d.stats()`, `d.chart()`, `d.value()`, etc.)
- **`c`** — Component helpers (`c.icon("ph:icon-name")`)

## Grid System

Dashboards use a column-based grid. Each widget can span multiple columns:

```typescript
.dashboard(({ d, c }) => d.dashboard({
  columns: 4,  // 4-column grid
  items: [
    d.stats({ span: 1, ... }),  // 1/4 width
    d.stats({ span: 2, ... }),  // 2/4 width
    d.chart({ span: 4, ... }),  // Full width
  ],
}))
```

## Widget Types

### Stats Widget

Display collection counts with optional filters:

```typescript
d.stats({
  id: "total-posts",
  collection: "posts",
  label: { en: "Total Posts" },
  icon: c.icon("ph:article"),
  span: 1,
})

// With static filter
d.stats({
  id: "active-barbers",
  collection: "barbers",
  label: { en: "Active Barbers" },
  icon: c.icon("ph:users"),
  filter: { isActive: true },
})

// With date filter
d.stats({
  id: "monthly-appointments",
  collection: "appointments",
  label: { en: "This Month" },
  dateFilter: {
    field: "scheduledAt",
    range: "thisMonth",  // "today" | "thisWeek" | "thisMonth" | "thisYear"
  },
})

// With server-side fetchFn for custom count logic
d.stats({
  id: "custom-count",
  collection: "posts",
  label: { en: "Featured Posts" },
  fetchFn: async ({ db }) => {
    const count = await db.select(...).where(...);
    return { count };
  },
})
```

### Value Widget

Display custom values with trends and formatting. Requires a `fetchFn`:

```typescript
d.value({
  id: "revenue",
  label: { en: "Monthly Revenue" },
  icon: c.icon("ph:currency-dollar"),
  span: 2,
  fetchFn: async ({ db }) => {
    const stats = await getRevenueStats(db);
    const change = calculateChange(stats);

    return {
      value: stats.totalRevenue / 100,
      formatted: `${stats.totalRevenue.toLocaleString()} €`,
      label: { en: "Monthly Revenue" },
      subtitle: { en: `${stats.count} completed` },
      footer: { en: "vs. last month" },
      icon: c.icon("ph:currency-dollar"),
      trend: {
        value: `${change >= 0 ? "+" : ""}${change}%`,
        icon: change >= 0 ? c.icon("ph:arrow-up") : c.icon("ph:arrow-down"),
      },
      classNames: {
        root: change >= 0 ? "border-green-500/30" : "border-red-500/30",
        value: change >= 0 ? "text-green-600" : "text-red-600",
      },
    };
  },
})
```

### Chart Widget

Display time-series or categorical charts:

```typescript
// Area/line chart (time-series)
d.chart({
  id: "appointments-chart",
  collection: "appointments",
  dateField: "scheduledAt",
  chartType: "area",  // "area" | "line" | "bar" | "pie"
  timeRange: "30d",   // "7d" | "30d" | "90d" | "1y"
  label: { en: "Appointments (30 days)" },
  span: 2,
})

// With custom data via fetchFn
d.chart({
  id: "revenue-chart",
  collection: "appointments",
  dateField: "createdAt",
  chartType: "line",
  label: { en: "Revenue Trend" },
  span: 3,
  fetchFn: async ({ db }) => {
    // Return array of { name, value } pairs
    return [
      { name: "Jan", value: 4200 },
      { name: "Feb", value: 5100 },
      { name: "Mar", value: 3800 },
    ];
  },
})
```

### Progress Widget

Display goal progress. Requires a `fetchFn`:

```typescript
d.progress({
  id: "monthly-goal",
  label: { en: "Revenue Goal" },
  showPercentage: true,
  span: 1,
  fetchFn: async ({ db }) => {
    const stats = await getRevenueStats(db);
    return {
      current: stats.totalRevenue,
      target: 500000,
      label: `${(stats.totalRevenue / 100).toLocaleString()} € / 5,000 €`,
      subtitle: stats.totalRevenue >= 500000
        ? "Goal reached!"
        : `${((500000 - stats.totalRevenue) / 100).toLocaleString()} € to go`,
    };
  },
})
```

### Recent Items Widget

Show recently created/updated collection items:

```typescript
d.recentItems({
  id: "recent-appointments",
  collection: "appointments",
  label: { en: "Recent Appointments" },
  dateField: "scheduledAt",
  limit: 5,
  span: 1,
})
```

### Table Widget

Display collection data in a mini table:

```typescript
d.table({
  id: "barbers-table",
  label: { en: "Team" },
  collection: "barbers",
  columns: [
    "name",
    "email",
    { key: "isActive", label: { en: "Status" } },
  ],
  limit: 5,
  sortBy: "name",
  sortOrder: "asc",
  span: 2,
})
```

### Timeline Widget

Display activity timeline. Requires a `fetchFn`:

```typescript
d.timeline({
  id: "activity",
  label: { en: "Recent Activity" },
  maxItems: 8,
  showTimestamps: true,
  timestampFormat: "relative",  // "relative" | "absolute" | "datetime"
  emptyMessage: { en: "No activity yet" },
  span: 2,
  fetchFn: async ({ cms }) => {
    const appointments = await cms.api.collections.appointments.find({
      limit: 8,
      orderBy: { updatedAt: "desc" },
    });

    return appointments.docs.map((apt) => ({
      id: apt.id,
      title: `Appointment #${apt.id.slice(0, 8)}`,
      description: `Status: ${apt.status}`,
      timestamp: apt.updatedAt,
      variant: apt.status === "completed" ? "success" : "default",
      // variant: "default" | "info" | "success" | "warning" | "error"
      icon: c.icon("ph:calendar"),
      href: `/admin/collections/appointments/${apt.id}`,
    }));
  },
})
```

### Quick Actions Widget

Display action buttons for common tasks:

```typescript
d.quickActions({
  id: "quick-actions",
  label: { en: "Quick Actions" },
  actions: [
    {
      label: { en: "New Appointment" },
      icon: c.icon("ph:calendar-plus"),
      action: { type: "create", collection: "appointments" },
    },
    {
      label: { en: "Add Barber" },
      icon: c.icon("ph:user-plus"),
      action: { type: "create", collection: "barbers" },
    },
    {
      label: { en: "Documentation" },
      icon: c.icon("ph:book-open"),
      action: { type: "link", href: "https://docs.example.com" },
    },
  ],
  span: 1,
})
```

### Custom Widget

Render a custom React component registered on the client:

```typescript
// Server: define the custom widget
d.custom({
  id: "weather",
  widgetType: "weather",  // Matches client-side widget name
  label: { en: "Weather" },
  props: { city: "Bratislava" },
  span: 1,
  fetchFn: async () => {
    // Optional: fetch data server-side
    return { temperature: 22, condition: "sunny" };
  },
})
```

```typescript
// Client: register the widget renderer
import { qa, widget } from "@questpie/admin/client";

const weatherWidget = widget("weather", {
  component: lazy(() => import("./widgets/weather")),
});

const admin = qa<AppCMS>()
  .use(adminModule)
  .widgets({ weather: weatherWidget });
```

## Layout Containers

### Section

Group widgets with a header:

```typescript
d.section({
  label: { en: "Key Metrics" },
  icon: c.icon("ph:chart-line"),
  layout: "grid",
  columns: 4,
  wrapper: "flat",  // "flat" | "card" | "collapsible"
  items: [
    d.stats({ ... }),
    d.stats({ ... }),
    d.value({ ... }),
  ],
})
```

### Tabs

Organize widgets into tabs:

```typescript
d.tabs({
  defaultTab: "overview",
  tabs: [
    {
      id: "overview",
      label: { en: "Overview" },
      items: [
        d.stats({ ... }),
        d.recentItems({ ... }),
      ],
    },
    {
      id: "analytics",
      label: { en: "Analytics" },
      items: [
        d.chart({ ... }),
        d.progress({ ... }),
      ],
    },
  ],
})
```

## Server-Side Data Fetching (`fetchFn`)

Widgets can fetch data on the server via `fetchFn`. This keeps sensitive database queries and business logic off the client:

```typescript
d.value({
  id: "revenue",
  fetchFn: async ({ cms, db, session, locale }) => {
    // Full access to CMS context, database, and user session
    const result = await db.select(...).from(...);
    return { value: result.total, formatted: `$${result.total}` };
  },
})
```

The `fetchFn` context provides:
- **`cms`** — The CMS instance with full API access
- **`db`** — Direct database access (Drizzle)
- **`session`** — Current user's session (for role-based data)
- **`locale`** — Current admin locale

### How it works

1. Server stores the `fetchFn` but doesn't serialize it to the client
2. Client receives `hasFetchFn: true` flag on the widget config
3. Client calls the `fetchWidgetData` RPC endpoint with the widget ID
4. Server executes the `fetchFn` and returns the result

### Client-side hook

For custom widgets, use `useServerWidgetData` to consume server-provided data:

```typescript
import { useServerWidgetData } from "@questpie/admin/client";

function MyCustomWidget({ config }) {
  const { data, isLoading } = useServerWidgetData<{ total: number }>(
    config.id,
    { enabled: config.hasFetchFn }
  );

  if (isLoading) return <Spinner />;
  return <div>{data?.total}</div>;
}
```

## Access Control

Control widget visibility per-user with the `access` property:

```typescript
// Always visible
d.stats({ access: true, ... })

// Hidden from all users
d.stats({ access: false, ... })

// Dynamic: check user role
d.value({
  id: "revenue",
  access: ({ session }) => session?.user?.role === "admin",
  fetchFn: async ({ db }) => { ... },
})
```

Access rules are evaluated server-side. Widgets that fail access checks are stripped from the config before it reaches the client.

## Complete Example

```typescript
// src/questpie/server/cms.ts
const cms = q({ name: "barbershop" })
  .use(baseInstance)
  .dashboard(({ d, c }) => d.dashboard({
    title: { en: "Dashboard" },
    columns: 4,
    items: [
      // Stats section
      d.section({
        label: { en: "Overview" },
        layout: "grid",
        columns: 4,
        items: [
          d.stats({
            collection: "appointments",
            label: { en: "Today's Appointments" },
            icon: c.icon("ph:calendar"),
            span: 1,
          }),
          d.stats({
            collection: "barbers",
            label: { en: "Active Barbers" },
            icon: c.icon("ph:users"),
            filter: { isActive: true },
            span: 1,
          }),
          d.value({
            id: "revenue",
            label: { en: "Revenue" },
            icon: c.icon("ph:currency-dollar"),
            span: 1,
            fetchFn: async ({ db }) => {
              const total = await getMonthlyRevenue(db);
              return { value: total, formatted: `${total.toLocaleString()} €` };
            },
            access: ({ session }) => session?.user?.role === "admin",
          }),
          d.progress({
            id: "booking-goal",
            label: { en: "Monthly Goal" },
            span: 1,
            fetchFn: async ({ db }) => ({
              current: 45,
              target: 100,
              label: "45 / 100 bookings",
            }),
          }),
        ],
      }),

      // Tabs for different views
      d.tabs({
        defaultTab: "overview",
        tabs: [
          {
            id: "overview",
            label: { en: "Overview" },
            items: [
              d.recentItems({
                collection: "appointments",
                label: { en: "Recent Appointments" },
                dateField: "scheduledAt",
                limit: 5,
                span: 2,
              }),
              d.quickActions({
                actions: [
                  {
                    label: { en: "New Appointment" },
                    icon: c.icon("ph:calendar-plus"),
                    action: { type: "create", collection: "appointments" },
                  },
                ],
                span: 2,
              }),
            ],
          },
          {
            id: "analytics",
            label: { en: "Analytics" },
            items: [
              d.chart({
                collection: "appointments",
                dateField: "scheduledAt",
                chartType: "area",
                timeRange: "30d",
                label: { en: "Appointments (30 days)" },
                span: 4,
              }),
            ],
          },
        ],
      }),
    ],
  }))
  .build({ ... });
```

## Related

- [Hooks](/docs/admin/hooks) — `useServerWidgetData` and other data hooks
- [Custom Widgets](/docs/admin/extensibility/custom-widgets) — Create your own widget renderers
- [Collections](/docs/admin/collections) — Collection configuration

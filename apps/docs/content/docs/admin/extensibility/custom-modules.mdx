---
title: Custom Modules
description: Building reusable modules for QUESTPIE Admin
---

# Custom Modules

Modules are the way to package and distribute QUESTPIE extensions. A module can include collections, fields, views, widgets, and more.

## Architecture

QUESTPIE has two layers of modules:

- **Server modules** — package collections, hooks, jobs, and admin configuration (sidebar, dashboard, actions)
- **Client modules** — package custom field renderers, views, widgets, and blocks for the admin UI

## Server Modules

Server modules use the `q()` builder to define collections with full admin configuration:

```typescript
// modules/blog/server.ts
import { q, text, boolean, datetime } from "questpie";

const posts = q.collection("posts")
  .fields({
    title: text("title").notNull(),
    content: text("content"),
    published: boolean("published").default(false),
    publishedAt: datetime("publishedAt"),
  })
  .admin(({ c }) => ({
    label: "Posts",
    icon: c.icon("ph:article"),
  }))
  .list(({ v, f }) => v.table({
    columns: [f.title, f.published, f.publishedAt],
  }))
  .form(({ v, f }) => v.form({
    sections: [{ fields: [f.title, f.content, f.published, f.publishedAt] }],
  }));

const categories = q.collection("categories")
  .fields({
    name: text("name").notNull(),
    slug: text("slug").notNull().unique(),
  })
  .admin(({ c }) => ({
    label: "Categories",
    icon: c.icon("ph:tag"),
  }));

// Export as a composable module
export const blogCollections = { posts, categories };
```

Use in your CMS:

```typescript
// src/questpie/server/cms.ts
import { blogCollections } from "./modules/blog/server";

export const cms = q({ name: "my-app" })
  .use(adminModule)
  .collections({
    ...blogCollections,
    // Your own collections...
  })
  .sidebar(({ s, c }) => s.sidebar({
    sections: [
      s.section({
        id: "blog",
        title: "Blog",
        icon: c.icon("ph:article"),
        items: [
          { type: "collection", collection: "posts", icon: c.icon("ph:article") },
          { type: "collection", collection: "categories", icon: c.icon("ph:tag") },
        ],
      }),
    ],
  }))
  .build({ db: { url: process.env.DATABASE_URL! } });
```

## Client Modules

Client modules use the `qa()` builder to register custom renderers:

```typescript
// modules/seo-module/client.ts
import { qa, field } from "@questpie/admin/client";

// Custom field renderer
const seoTitleField = field("seoTitle", {
  component: SeoTitleField,
  cell: SeoTitleCell,
  config: {} as { label?: string; maxLength?: number },
  defaultConfig: { maxLength: 60 },
  createZod: (c) => z.string().max(c.maxLength ?? 60),
});

const seoDescriptionField = field("seoDescription", {
  component: SeoDescriptionField,
  config: {} as { label?: string; maxLength?: number },
  defaultConfig: { maxLength: 160 },
});

// Export client module
export const seoModule = qa()
  .fields({
    seoTitle: seoTitleField,
    seoDescription: seoDescriptionField,
  });

// Usage in client admin
const admin = qa()
  .use(adminModule)
  .use(seoModule);  // Now seoTitle and seoDescription are available
```

## Client Module with Widgets

```typescript
// modules/analytics-module/client.ts
import { qa, widget } from "@questpie/admin/client";

const pageViewsWidget = widget("pageViews", {
  component: PageViewsChart,
  config: {} as { period: "day" | "week" | "month" },
});

const topPagesWidget = widget("topPages", {
  component: TopPagesList,
  config: {} as { limit: number },
});

export const analyticsModule = qa()
  .widgets({
    pageViews: pageViewsWidget,
    topPages: topPagesWidget,
  });
```

## Module Patterns

### Configurable Module

```typescript
// modules/blog-module.ts
interface BlogModuleOptions {
  enableComments?: boolean;
  enableDrafts?: boolean;
}

export function createBlogCollections(options: BlogModuleOptions = {}) {
  const posts = q.collection("posts")
    .fields({
      title: text("title").notNull(),
      content: text("content"),
      ...(options.enableDrafts && {
        status: text("status").$type<"draft" | "published">().default("draft"),
      }),
    })
    .admin(({ c }) => ({
      label: "Posts",
      icon: c.icon("ph:article"),
    }));

  const collections: Record<string, any> = { posts };

  if (options.enableComments) {
    collections.comments = q.collection("comments")
      .fields({
        content: text("content").notNull(),
        author: text("author").notNull(),
      })
      .admin(({ c }) => ({
        label: "Comments",
        icon: c.icon("ph:chat-circle"),
      }));
  }

  return collections;
}

// Usage
const cms = q({ name: "my-app" })
  .use(adminModule)
  .collections({
    ...createBlogCollections({ enableComments: true, enableDrafts: true }),
  })
  .build({ db: { url: "..." } });
```

### Plugin Architecture

```typescript
// modules/plugin-system.ts
interface Plugin {
  name: string;
  collections: Record<string, any>;
  clientModule?: ReturnType<typeof qa>;
  priority?: number;
}

export function buildCmsWithPlugins(plugins: Plugin[]) {
  const sorted = [...plugins].sort((a, b) => (a.priority ?? 0) - (b.priority ?? 0));

  const allCollections = {};
  for (const plugin of sorted) {
    Object.assign(allCollections, plugin.collections);
  }

  return allCollections;
}
```

### Theme Module (Client)

```typescript
// modules/theme-module.ts
export function createThemeModule(theme: {
  primaryColor: string;
  accentColor: string;
  logo?: string;
}) {
  return qa()
    .branding({
      name: "My CMS",
      logo: theme.logo,
      colors: {
        primary: theme.primaryColor,
        accent: theme.accentColor,
      },
    });
}

// Usage
const admin = qa()
  .use(adminModule)
  .use(createThemeModule({
    primaryColor: "#3b82f6",
    accentColor: "#8b5cf6",
    logo: "/logo.svg",
  }));
```

### Localization Module (Client)

```typescript
// modules/i18n-module.ts
export function createI18nModule(translations: Record<string, any>) {
  return qa()
    .locale({
      translations,
      defaultLocale: "en",
    });
}

// Usage
const admin = qa()
  .use(adminModule)
  .use(createI18nModule({ en: enTranslations }));
```

## Publishing Modules

### Package Structure

```
my-questpie-module/
├── src/
│   ├── server/           # Server-side collections + admin config
│   │   ├── index.ts
│   │   └── collections/
│   ├── client/           # Client-side renderers
│   │   ├── index.ts
│   │   ├── fields/
│   │   ├── widgets/
│   │   └── components/
│   └── index.ts          # Re-exports
├── package.json
├── tsconfig.json
└── README.md
```

### Package.json

```json
{
  "name": "@my-org/questpie-blog-module",
  "version": "1.0.0",
  "exports": {
    "./server": {
      "import": "./dist/server/index.js",
      "types": "./dist/server/index.d.ts"
    },
    "./client": {
      "import": "./dist/client/index.js",
      "types": "./dist/client/index.d.ts"
    }
  },
  "peerDependencies": {
    "questpie": "^1.0.0",
    "@questpie/admin": "^1.0.0",
    "react": "^18.0.0"
  }
}
```

### Main Exports

```typescript
// src/server/index.ts
export { blogCollections, createBlogCollections } from "./collections";
export type { BlogModuleOptions } from "./types";

// src/client/index.ts
export { blogClientModule } from "./module";
export { PostCard } from "./components/PostCard";
```

## Best Practices

### 1. Separate Server and Client

Keep server-side (collections, admin config) and client-side (renderers, components) in separate entry points.

### 2. Make It Configurable

```typescript
// Don't hardcode values
export function createModule(options: ModuleOptions) {
  return createBlogCollections(options);
}
```

### 3. Export Types

```typescript
export type { BlogModuleOptions } from "./types";
export type { PostFields, CategoryFields } from "./collections";
```

### 4. Use `c.icon()` for Icons

Always use the `c.icon("ph:icon-name")` helper for icons in server-side admin config.

## Related

- [Custom Fields](/docs/admin/extensibility/custom-fields) - Create new field types
- [Architecture](/docs/admin/architecture) - Server vs client layers

---
title: Your First CMS
description: Build a complete CMS from scratch
---

# Your First CMS

This tutorial walks you through building a complete blog CMS with posts, authors, and categories.

## What We'll Build

- Posts collection with rich text content
- Authors collection
- Categories collection
- Relations between collections
- Admin interface with sidebar navigation
- API endpoints for frontend consumption

## Step 1: Create the Backend

### Define Collections

```typescript
// src/questpie/server/collections/posts.ts
import { q, text, boolean, datetime, integer } from "questpie";

export const posts = q.collection("posts")
  .fields({
    title: text("title").notNull(),
    slug: text("slug").notNull().unique(),
    excerpt: text("excerpt"),
    content: text("content"),
    published: boolean("published").default(false),
    publishedAt: datetime("publishedAt"),
    authorId: text("authorId"),
    categoryId: text("categoryId"),
    viewCount: integer("viewCount").default(0),
  })
  .relations(({ one }) => ({
    author: one("authors", {
      fields: ["authorId"],
      references: ["id"],
    }),
    category: one("categories", {
      fields: ["categoryId"],
      references: ["id"],
    }),
  }))
  .validation(({ z }) => ({
    title: z.string().min(1).max(200),
    slug: z.string().regex(/^[a-z0-9-]+$/),
    excerpt: z.string().max(500).optional(),
    content: z.string().optional(),
  }))
  .hooks({
    beforeCreate: async ({ data, ctx }) => {
      // Auto-generate slug from title
      if (!data.slug && data.title) {
        data.slug = data.title
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/(^-|-$)/g, "");
      }
      return data;
    },
  });
```

```typescript
// src/questpie/server/collections/authors.ts
import { q, text, boolean } from "questpie";

export const authors = q.collection("authors")
  .fields({
    name: text("name").notNull(),
    email: text("email").notNull().unique(),
    bio: text("bio"),
    avatarUrl: text("avatarUrl"),
    isActive: boolean("isActive").default(true),
  })
  .validation(({ z }) => ({
    name: z.string().min(1).max(100),
    email: z.string().email(),
    bio: z.string().max(1000).optional(),
  }));
```

```typescript
// src/questpie/server/collections/categories.ts
import { q, text, integer } from "questpie";

export const categories = q.collection("categories")
  .fields({
    name: text("name").notNull(),
    slug: text("slug").notNull().unique(),
    description: text("description"),
    order: integer("order").default(0),
  })
  .validation(({ z }) => ({
    name: z.string().min(1).max(50),
    slug: z.string().regex(/^[a-z0-9-]+$/),
  }));
```

### Build the CMS

```typescript
// src/questpie/server/cms.ts
import { q } from "questpie";
import { adminModule } from "@questpie/admin/server";
import { posts } from "./collections/posts";
import { authors } from "./collections/authors";
import { categories } from "./collections/categories";

export const cms = q({ name: "blog-cms" })
  .use(adminModule)  // Adds users, assets, auth
  .collections({
    posts,
    authors,
    categories,
  })
  .auth({
    emailAndPassword: { enabled: true },
    secret: process.env.AUTH_SECRET!,
    baseURL: process.env.APP_URL,
    basePath: "/api/cms/auth",
  })
  .build({
    db: {
      url: process.env.DATABASE_URL!,
    },
  });

export type AppCMS = typeof cms;
```

## Step 2: Add Admin Configuration (Server-Side)

Admin UI configuration lives on the **server** alongside your collection definitions. Add `.admin()`, `.list()`, and `.form()` to each collection:

```typescript
// src/questpie/server/collections/posts.ts (updated)
import { q, text, boolean, datetime, integer } from "questpie";

export const posts = q.collection("posts")
  .fields({
    title: text("title").notNull(),
    slug: text("slug").notNull().unique(),
    excerpt: text("excerpt"),
    content: text("content"),
    published: boolean("published").default(false),
    publishedAt: datetime("publishedAt"),
    authorId: text("authorId"),
    categoryId: text("categoryId"),
    viewCount: integer("viewCount").default(0),
  })
  .relations(({ one }) => ({
    author: one("authors", { fields: ["authorId"], references: ["id"] }),
    category: one("categories", { fields: ["categoryId"], references: ["id"] }),
  }))
  .validation(({ z }) => ({
    title: z.string().min(1).max(200),
    slug: z.string().regex(/^[a-z0-9-]+$/),
  }))
  // Admin UI configuration
  .admin(({ c }) => ({
    label: "Posts",
    icon: c.icon("ph:article"),
    description: "Blog posts and articles",
  }))
  .list(({ v, f }) => v.table({
    columns: [f.title, f.author, f.category, f.published, f.publishedAt],
    defaultSort: { field: "publishedAt", direction: "desc" },
    filterable: [f.published, f.category, f.author],
    searchable: ["title"],
  }))
  .form(({ v, f }) => v.form({
    sidebar: {
      position: "right",
      fields: [f.published, f.publishedAt, f.author, f.category],
    },
    sections: [
      {
        label: "Content",
        fields: [f.title, f.slug, f.excerpt, f.content],
      },
    ],
  }));
```

```typescript
// src/questpie/server/collections/authors.ts (updated)
import { q, text, boolean } from "questpie";

export const authors = q.collection("authors")
  .fields({
    name: text("name").notNull(),
    email: text("email").notNull().unique(),
    bio: text("bio"),
    avatarUrl: text("avatarUrl"),
    isActive: boolean("isActive").default(true),
  })
  .admin(({ c }) => ({
    label: "Authors",
    icon: c.icon("ph:users"),
  }))
  .list(({ v, f }) => v.table({
    columns: [f.name, f.email, f.isActive],
  }))
  .form(({ v, f }) => v.form({
    sidebar: { position: "right", fields: [f.isActive, f.avatarUrl] },
    fields: [f.name, f.email, f.bio],
  }));
```

```typescript
// src/questpie/server/collections/categories.ts (updated)
import { q, text, integer } from "questpie";

export const categories = q.collection("categories")
  .fields({
    name: text("name").notNull(),
    slug: text("slug").notNull().unique(),
    description: text("description"),
    order: integer("order").default(0),
  })
  .admin(({ c }) => ({
    label: "Categories",
    icon: c.icon("ph:folder"),
  }))
  .list(({ v, f }) => v.table({
    columns: [f.name, f.slug, f.order],
    defaultSort: { field: "order", direction: "asc" },
  }))
  .form(({ v, f }) => v.form({
    fields: [f.name, f.slug, f.description, f.order],
  }));
```

### Configure Sidebar and Dashboard (Server-Side)

```typescript
// src/questpie/server/cms.ts (updated)
import { q } from "questpie";
import { adminModule } from "@questpie/admin/server";
import { posts } from "./collections/posts";
import { authors } from "./collections/authors";
import { categories } from "./collections/categories";

export const cms = q({ name: "blog-cms" })
  .use(adminModule)
  .collections({ posts, authors, categories })
  .auth({
    emailAndPassword: { enabled: true },
    secret: process.env.AUTH_SECRET!,
    baseURL: process.env.APP_URL,
    basePath: "/api/cms/auth",
  })
  .sidebar(({ s, c }) => s.sidebar({
    sections: [
      s.section({
        id: "content",
        title: "Content",
        icon: c.icon("ph:files"),
        items: [
          { type: "collection", collection: "posts", icon: c.icon("ph:article") },
          { type: "collection", collection: "categories", icon: c.icon("ph:folder") },
        ],
      }),
      s.section({
        id: "people",
        title: "People",
        icon: c.icon("ph:users"),
        items: [
          { type: "collection", collection: "authors", icon: c.icon("ph:users") },
        ],
      }),
    ],
  }))
  .dashboard(({ d, c }) => d.dashboard({
    items: [
      d.stats({ collection: "posts", label: "Total Posts", icon: c.icon("ph:article") }),
      d.stats({ collection: "authors", label: "Authors", icon: c.icon("ph:users") }),
      d.recentItems({ collection: "posts", label: "Recent Posts", limit: 5 }),
    ],
  }))
  .build({
    db: { url: process.env.DATABASE_URL! },
  });

export type AppCMS = typeof cms;
```

### Create Client Admin Config

The client-side `qa()` builder only handles rendering and branding:

```typescript
// src/questpie/admin/admin.ts
import { qa, adminModule } from "@questpie/admin/client";
import type { AppCMS } from "../server/cms";

export const admin = qa<AppCMS>()
  .use(adminModule)
  .branding({ name: "My Blog CMS" });
```

## Step 3: Mount the API and Admin

### API Route

```typescript
// src/server.ts (Hono example)
import { Hono } from "hono";
import { createHonoAdapter } from "@questpie/hono";
import { cms } from "./questpie/server/cms";

const app = new Hono();
app.route("/api/cms", createHonoAdapter(cms));

export default app;
```

### Admin Route

```tsx
// src/routes/admin.tsx
import { Admin, AdminLayoutProvider } from "@questpie/admin/client";
import { Link, Outlet, useLocation } from "@tanstack/react-router";
import { admin } from "@/questpie/admin/admin";
import { createClient } from "questpie/client";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import type { AppCMS } from "@/questpie/server/cms";

const cmsClient = createClient<AppCMS>({ baseUrl: "/api/cms" });
const queryClient = new QueryClient();
const adminInstance = Admin.from(admin);

export default function AdminLayout() {
  const location = useLocation();

  return (
    <QueryClientProvider client={queryClient}>
      <AdminLayoutProvider
        admin={adminInstance}
        client={cmsClient}
        queryClient={queryClient}
        LinkComponent={Link}
        activeRoute={location.pathname}
        basePath="/admin"
      >
        <Outlet />
      </AdminLayoutProvider>
    </QueryClientProvider>
  );
}
```

## Step 4: Run and Test

```bash
# Generate and run migrations
bun run drizzle-kit generate
bun run drizzle-kit migrate

# Start dev server
bun run dev
```

Visit `http://localhost:3000/admin`:

1. Create a user account
2. Add some categories
3. Add some authors
4. Create your first post

## Related

- [Backend Deep Dive](/docs/backend) - Learn all q() builder features
- [Admin UI Deep Dive](/docs/admin) - Advanced admin configuration
- [Full Example](/docs/examples/barbershop) - See a production-ready implementation
